# Bật Rewrite Engine
RewriteEngine On
RewriteBase /DFF.VN/
# thangwf naof dua len server xoa cai DFF.VN/



# ------------------------------------
# Toggle bảo trì NGAY TRONG .htaccess
# Mặc định tắt. Muốn bật, bỏ dấu # ở dòng SetEnvIf bên dưới:
 #SetEnvIf Request_URI "^" MAINTENANCE=on
# (Có thể whitelist IP admin để vẫn truy cập site khi bảo trì)
# SetEnvIfExpr "%{REMOTE_ADDR} == '127.0.0.1'" MAINT_WHITELIST=1

# ------------------------------------
# 0. Maintenance mode → redirect all to /Fix/
#    Bật bằng cách: tạo file Fix/maintenance.on HOẶC set env MAINTENANCE=on
#    Tắt: xóa file trên hoặc unset env
# ------------------------------------
# Bỏ qua nếu đã vào thư mục Fix hoặc file tĩnh
##RewriteCond %{DOCUMENT_ROOT}/DFF.VN/Fix/maintenance.on -f
# Nếu đang whitelist thì bỏ qua redirect (cho IP admin)
#RewriteCond %{ENV:MAINT_WHITELIST} !1
#RewriteCond %{REQUEST_URI} !^/DFF\.VN/Fix/ [NC]
#RewriteCond %{REQUEST_URI} !\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|pdf|txt|mp4|webp)$ [NC]
#RewriteRule ^.*$ Fix/ [R=302,L]


# ------------------------------------
# 1. Bỏ qua file tĩnh (không redirect qua index.php hoặc admin.php)
# ------------------------------------
RewriteCond %{REQUEST_URI} \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot|pdf|txt|mp4|webp)$ [NC]
RewriteRule . - [L]

# ------------------------------------
# 1.5. Rào bảo vệ - Chặn truy cập trực tiếp vào các thư mục nhạy cảm
# ------------------------------------
#RewriteRule ^(controller|model|view|config|helpers|public|vendor)/ - [F,L]

# ------------------------------------
# 1.6. Chặn truy cập trực tiếp vào các file PHP ở root (trừ index.php và admin.php)
# ------------------------------------
#RewriteCond %{REQUEST_FILENAME} -f
#RewriteCond %{REQUEST_URI} !^/DFF\.VN/(index\.php|admin\.php)$
#RewriteCond %{REQUEST_URI} \.php$
#RewriteRule . - [F,L]

# ------------------------------------
# 2. Admin route
# ------------------------------------
# Nếu URL bắt đầu bằng /admin thì chuyển về admin.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^admin(?:/(.*))?$ admin.php?url=$1 [QSA,L]

# ------------------------------------
# 3. Frontend route
# ------------------------------------
# Các request còn lại → index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]

# ------------------------------------
# 4. Bảo mật
# ------------------------------------
ServerSignature Off
<FilesMatch "\.(htaccess|htpasswd|ini|log|sh|sql|bak|inc|json)$">
    Require all denied
</FilesMatch>

# ------------------------------------
# 5. Cache file tĩnh để tăng tốc độ
# ------------------------------------
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresDefault "access plus 7 days"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/ttf "access plus 1 year"
</IfModule>

# php -- BEGIN cPanel-generated handler, do not edit
# Set the “alt-php82” package as the default “PHP” programming language.
<IfModule mime_module>
  AddHandler application/x-httpd-alt-php82 .php .php8 .phtml
</IfModule>
# php -- END cPanel-generated handler, do not edit
