if(null==Page)function Page(){}var urlBase=Page.urlBase+"Article.ashx";function formatMoney(t,e,a,n,i){e=isNaN(e=Math.abs(e))?2:e,a=void 0!==a?a:"₫",n=n||",",i=i||".";var o=t,s=o<0?"-":"",r=parseInt(o=Math.abs(+o||0).toFixed(e),10)+"",l=(l=r.length)>3?l%3:0;return s+(l?r.substr(0,l)+n:"")+r.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+n)+(e?i+Math.abs(o-r).toFixed(e).slice(2):"")+a}var cEditor,editor,tinyMCE=function(t,e,a,n){try{tinymce.init({language:"vi",mode:"none",placeholder:"Nhập nội dung",selector:t,theme:"modern",plugins:["advlist lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount code fullscreen","insertdatetime media table contextmenu directionality imagetools","paste textcolor colorpicker zeldinder  ","stickytoolbar"],paste_as_text:!0,fontsize_formats:"11px 12px 13px 14px 18px 24px 36px",toolbar1:"removeformat | undo redo | bold italic |  alignleft aligncenter alignright alignjustify | outdent indent | code | paste | copy",toolbar2:"image media | link | table ",table_default_styles:{width:"100%","border-collapse":"collapse"},table_default_attributes:{border:"1",cellspacing:"0",cellpadding:"0"},paste_enable_default_filters:!1,height:e,image_advtab:!0,menubar:!1,convert_urls:!1,relative_urls:!1,remove_script_host:!1,paste_word_valid_elements:"p,b,strong,i,em,h1,h2,table,tr,td,th",paste_merge_formats:!1,paste_convert_word_fake_lists:!1,paste_remove_styles_if_webkit:!0,invalid_elements:"ol",extended_valid_elements:"@[content|http-equiv|URL],meta,script[language|type|src]",valid_children:"+body[meta],+div[h2|span|meta|object],+p[h2|span|meta|object]",resize:!1,setup:function(t){t.on("change",(function(t){flag=!0,null!=n&&null!=n&&"function"==typeof n?n():void 0===n&&(n=function(){})})),t.on("DblClick",(function(t){"IMG"==t.target.nodeName&&tinymce.get("txtBody").execCommand("mceEditImage")}))}}),null!=n&&null!=n&&"function"==typeof n?n():void 0===n&&(n=function(){})}catch{}},fileManager=function(t,e,a,n,i){BootstrapDialog.show({title:"Quản lý file",size:BootstrapDialog.SIZE_WIDE,message:function(o){var s=$("<div></div>"),r={url:Utility.ElFinder,width:"100%",height:"380",lang:"vi",requestType:"post",closeOnEditorCallback:!0,editorCallback:a,uiOptions:{getfile:{oncomplete:"destroy"},toolbar:[["mkdir","upload"],["select"]],tree:{openRootOnLoad:!0,syncTree:!0},navbar:{minWidth:150,maxWidth:500},cwd:{oldSchool:!1}},contextmenu:{navbar:["back","|","upload","|","info","|","rm","resize","crop"],cwd:["back","|","upload","|","info","|","rm","resize","crop"],files:["back","|","upload","|","info","|","rm","resize","crop"]},resizable:!1,sort:"date",sortDirect:"desc",showFiles:1e3,getFileCallback:function(s){var r={path:s.path,t:2};if(null!=n&&null!=i){var l=0,c=0,d=new Image;d.src=Utility.DomainBackEnd+"Upload/"+s.path,$(d).load((function(){l=d.width,c=d.height,l/c==n/i?$.ajax({type:"POST",async:!0,url:"/Vendor/DffVn/News/Handler/File.ashx",data:r,cache:!0,dataType:"json",success:function(n){null!=n.data&&(n.data=n.Data.replace(""+Utility.DomainImage,""),$(t).val(n.data),$(e).attr("src",Utility.DomainImage+n.data),o.close(),null!=a&&null!=a&&"function"==typeof a&&a())}}):BootstrapDialog.show({type:BootstrapDialog.TYPE_WARNING,title:"Thông báo",message:"Bạn chọn tỷ lệ không đúng vui lòng chỉnh sửa lại đúng kích thước [ "+n+"x"+i+" ]",draggable:!0})}))}else $.ajax({type:"POST",async:!0,url:"/Vendor/DffVn/News/Handler/File.ashx",data:r,cache:!0,dataType:"json",success:function(n){null!=n.data&&(n.data=n.data.replace(""+Utility.DomainImage,""),$(t).val(n.data),$(e).attr("src",Utility.DomainImage+n.data),o.close(),null!=a&&null!=a&&"function"==typeof a&&a())}})}};return s.elfinder(r).elfinder("instance"),s},draggable:!0})},saved=!1;function scrollToError(t){$("html, body").animate({scrollTop:$(t).offset().top-500},1e3)}function EditorSave(t){if($("#formEdit").valid()){$("#errorAvatar,#errorCat").hide();var e=$(".cat-id").val();return $("#CatId").val(e),-1!==$(".avatarNews").attr("src").indexOf("img_small.jpg")?($("#errorAvatar").show(),void scrollToError("#errorAvatar")):0==e?(scrollToError("#errorCat"),void $("#errorCat").show()):void(saved||(saved=!0,2==t?swal({title:"Bạn có muốn đăng bài?",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Đồng ý",cancelButtonText:"Thoát!"}).then((function(e){e.value?EditorToSave(t):saved=!1})).catch((function(t){})):EditorToSave(t)))}scrollToError(".error")}function getData(t){var e=Page.urlBase+"Article.ashx?t=18",a={id:t};$.ajax({type:"POST",url:e,data:a,success:function(t){200==t.code&&initBlock(t.data)}})}class CustomImageTool extends ImageTool{constructor({data:t,config:e,api:a}){super({data:t,config:e,api:a}),this.config=e,this.api=a}render(){const t=super.render(),e=document.createElement("button");e.innerText="Upload",e.classList.add("jsimgcancel"),e.addEventListener("click",(()=>this._openFilePicker()));const a=document.createElement("button");a.innerText="Chọn ảnh từ thư viện",a.classList.add("jsimgcancel");var n=this;a.addEventListener("click",(()=>{openLibrary(n,1)}));const i=document.createElement("button");i.textContent="Hủy",i.classList.add("jsimgcancel"),i.addEventListener("click",(()=>{const t=this.api.blocks.getCurrentBlockIndex();-1!==t&&this.api.blocks.delete(t)})),e.setAttribute("type","button"),a.setAttribute("type","button"),i.setAttribute("type","button");const o=document.createElement("div");return o.classList.add("image-buttons"),o.appendChild(e),o.appendChild(a),o.appendChild(i),t.appendChild(o),t}_openFilePicker(){const t=document.createElement("input");t.type="file",t.accept="image/*",t.addEventListener("change",(async t=>{const e=t.target.files[0];if(e){const t=new FormData;t.append("image",e);try{const e=await fetch(this.config.byFile,{method:"POST",body:t}),a=await e.json(),n=this.api.blocks.getCurrentBlockIndex();this._updateImage(n,a)}catch(t){console.log("Upload failed:"+t)}}})),t.click()}_updateImage(t,e){if(this.data={file:{url:e.file.url},caption:this.data.caption||""},-1!==t)try{this.api.blocks.update(this.api.blocks.getBlockByIndex(t).id,this.data)}catch(t){console.log("Upload failed:"+t)}}}class CustomImageTool2 extends ImageTool{constructor(t){super(t),this.api=t.api}render(){const t=super.render(),e=document.createElement("button");return e.textContent="Hủy",e.classList.add("jsimgcancel"),e.addEventListener("click",(()=>{const t=this.api.blocks.getCurrentBlockIndex();-1!==t&&this.api.blocks.delete(t)})),t.appendChild(e),t}}class ImageWithText3{constructor({data:t,api:e,config:a}){this.api=e,this.config=a||{},this.data={file:t.file||{url:""},alignment:t.alignment||"left",text:t.text||"",caption:t.caption||""},this.wrapper=null}static get toolbox(){return{title:"Image with Text",icon:'<svg width="17" height="15" viewBox="0 0 17 15"><path d="M0 0h17v10H0zM2 12h13v2H2z"/></svg>'}}render(){this.wrapper=document.createElement("div"),this.wrapper.classList.add("image-with-text");const t=document.createElement("div");t.classList.add("toolbar");const e=document.createElement("button");e.textContent="Tải ảnh",e.setAttribute("type","button"),e.addEventListener("click",(()=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.addEventListener("change",(t=>this.onUpload(t))),t.click()}));const a=document.createElement("button");a.textContent="Trái",a.setAttribute("type","button"),a.addEventListener("click",(()=>{this.data.alignment="left",this.updateAlignment()}));const n=document.createElement("button");n.textContent="Phải",n.setAttribute("type","button"),n.addEventListener("click",(()=>{this.data.alignment="right",this.updateAlignment()})),t.appendChild(e),t.appendChild(a),t.appendChild(n);const i=document.createElement("div");i.classList.add("content");const o=document.createElement("div");o.classList.add("image-container");const s=document.createElement("div");if(s.classList.add("image-wrapper"),this.data.file.url){const t=document.createElement("img");t.src=this.data.file.url,s.appendChild(t)}const r=document.createElement("div");r.classList.add("caption-container"),r.contentEditable=!0,r.innerHTML=this.data.caption||"",r.addEventListener("input",(()=>{this.data.caption=r.innerHTML})),o.appendChild(s),o.appendChild(r);const l=document.createElement("div");return l.classList.add("text-container"),l.contentEditable=!0,l.innerHTML=this.data.text||"",l.addEventListener("input",(()=>{this.data.text=l.innerHTML})),i.appendChild(o),i.appendChild(l),this.wrapper.appendChild(t),this.wrapper.appendChild(i),this.updateAlignment(),this.wrapper}updateAlignment(){const t=this.wrapper.querySelector(".image-container"),e=this.wrapper.querySelector(".content");t.style.float="",t.style.margin="",e.style.overflow="hidden",t.style.float=this.data.alignment,t.style.margin="left"===this.data.alignment?"0 15px 15px 0":"0 0 15px 15px"}async onUpload(t){const e=t.target.files[0];if(e)try{const t=new FormData;t.append("image",e),console.log(this.config.uploadUrl);const a=await fetch(this.config.uploadUrl||"/api/upload",{method:"POST",body:t}),n=await a.json();if(!n.file.url)throw new Error("Không nhận được URL ảnh từ server");this.data.file={url:n.file.url};const i=this.wrapper.querySelector(".image-wrapper");i.innerHTML="";const o=document.createElement("img");o.src=n.file.url,i.appendChild(o),this.updateAlignment()}catch(t){console.error("Lỗi khi upload ảnh:",t),alert("Không thể upload ảnh. Vui lòng thử lại.")}}save(){return{file:this.data.file,alignment:this.data.alignment,text:this.data.text,caption:this.data.caption}}}class ImageWithText{constructor({data:t,api:e,config:a}){this.api=e,this.config=a||{},this.data={file:t.file||{url:""},alignment:t.alignment||"left",text:t.text||"",caption:t.caption||"",size:t.size||30},this.wrapper=null}static get toolbox(){return{title:"Image with Text",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">\x3c!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--\x3e<path d="M464 448H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h416c26.5 0 48 21.5 48 48v288c0 26.5-21.5 48-48 48zM112 120c-30.9 0-56 25.1-56 56s25.1 56 56 56 56-25.1 56-56-25.1-56-56-56zM64 384h384V272l-87.5-87.5c-4.7-4.7-12.3-4.7-17 0L208 320l-55.5-55.5c-4.7-4.7-12.3-4.7-17 0L64 336v48z"/></svg>'}}render(){this.wrapper=document.createElement("div"),this.wrapper.classList.add("image-with-text");const t=document.createElement("div");t.classList.add("toolbar");const e=document.createElement("button");e.textContent="Upload",e.setAttribute("type","button"),e.addEventListener("click",(()=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.addEventListener("change",(t=>this.onUpload(t))),t.click()}));const a=document.createElement("button");a.innerText="Chọn ảnh từ thư viện",a.setAttribute("type","button"),a.addEventListener("click",(()=>openLibrary(this,3)));const n=document.createElement("button");n.textContent="Trái",n.setAttribute("type","button"),n.addEventListener("click",(()=>{this.data.alignment="left",this.updateAlignment()}));const i=document.createElement("button");i.textContent="Phải",i.setAttribute("type","button"),i.addEventListener("click",(()=>{this.data.alignment="right",this.updateAlignment()})),t.appendChild(e),t.appendChild(a),t.appendChild(n),t.appendChild(i);const o=document.createElement("div");o.classList.add("content");const s=document.createElement("div");s.classList.add("image-container");const r=document.createElement("div");r.classList.add("image-wrapper"),this.data.file.url||(this.data.file.url="/Vendor/DffVn/Content/img/img_small.jpg");const l=document.createElement("img");l.src=this.data.file.url,r.appendChild(l);const c=document.createElement("select");["30","40","50","60","70"].forEach(((t,e)=>{const a=document.createElement("option");a.value=t,a.textContent=t+"%",t===this.data.size&&(a.selected=!0),c.appendChild(a)})),c.addEventListener("change",(t=>{const e=t.target.value;this.data.size=e,s.className="",s.classList.add("w"+e)})),t.appendChild(c);const d=document.createElement("div");d.classList.add("caption-container"),d.contentEditable=!0,d.innerHTML=this.data.caption||"",d.addEventListener("input",(()=>{this.data.caption=d.innerHTML})),s.appendChild(r),s.appendChild(d);const u=document.createElement("div");return u.classList.add("text-container"),u.contentEditable=!0,u.innerHTML=this.data.text||"",u.addEventListener("input",(()=>{this.data.text=u.innerHTML})),u.addEventListener("paste",(t=>{t.preventDefault();const e=(t.clipboardData||window.clipboardData).getData("text/plain");document.execCommand("insertText",!1,e)})),o.appendChild(s),o.appendChild(u),this.wrapper.appendChild(t),this.wrapper.appendChild(o),this.updateAlignment(),this.wrapper}updateAlignment(){const t=this.wrapper.querySelector(".image-container"),e=this.wrapper.querySelector(".content");t.style.float="",t.style.margin="",e.style.overflow="hidden",t.style.float=this.data.alignment,t.style.margin="left"===this.data.alignment?"0 15px 15px 0":"0 0 15px 15px"}async onUpload(t){const e=t.target.files[0];if(e)try{const t=new FormData;t.append("image",e);const a=await fetch(this.config.uploadUrl||"/api/upload",{method:"POST",body:t}),n=await a.json();if(!n.file.url)throw new Error("Không nhận được URL ảnh từ server");this.data.file={url:n.file.url};const i=this.wrapper.querySelector(".image-wrapper");i.innerHTML="";const o=document.createElement("img");o.src=n.file.url,i.appendChild(o),this.updateAlignment()}catch(t){console.error("Lỗi khi upload ảnh:",t)}}onSelect(t){const e=this.wrapper.querySelector(".image-wrapper");e.innerHTML="";const a=document.createElement("img");this.data.file={url:t},a.src=t,e.appendChild(a),this.updateAlignment()}save(){return{file:this.data.file,alignment:this.data.alignment,text:this.data.text,caption:this.data.caption,size:this.data.size}}}class CustomTable extends Table{constructor({data:t,config:e,api:a,readOnly:n}){super({data:t,config:e,api:a,readOnly:n}),this.api=a,this.config=e||{},this.readOnly=n,this.data=t||{content:[]}}render(){const t=super.render();return t.querySelectorAll(".tc-cell").forEach((t=>{t.innerHTML&&(t.innerHTML=t.innerHTML.replace(/\n/g,"<br>"))})),t}save(t){const e=super.save(t);if(!t||!t.querySelector(".tc-table"))return console.error("blockContent hoặc tc-table không tồn tại:",t),e;const a=t.querySelector(".tc-table").querySelectorAll(".tc-row"),n=[];return a.forEach((t=>{const e=t.querySelectorAll(".tc-cell"),a=[];e.forEach((t=>{const e=t.innerHTML.replace(/<br\s*\/?>/gi,"\n");a.push(e)})),n.push(a)})),{...e,content:n}}}function initBlock(t){var e="/Vendor/DffVn/News/Handler/File.ashx?t=";editor=new EditorJS({holder:"bodyjs",tools:{header:{class:Header,inlineToolbar:!0,config:{placeholder:"Header"},shortcut:"CMD+SHIFT+H"},paragraph:{class:Paragraph,inlineToolbar:!0},image:{class:CustomImageTool,config:{endpoints:{byFile:e+"3",byUrl:e+"5"},uploadUrl:e+"3"}},imageWithText:{class:ImageWithText,config:{uploadUrl:e+"3"}},table:{class:CustomTable,inlineToolbar:!0,shortcut:"CMD+ALT+T",config:{rows:2,cols:3}},Marker:{class:MarkerTool,shortcut:"CMD+SHIFT+M"},quote:{class:Quote,inlineToolbar:!0,config:{quotePlaceholder:"Enter a quote",captionPlaceholder:"Quote's author"},shortcut:"CMD+SHIFT+O"}},placeholder:"Nội dung chủ đề",data:{blocks:t},onReady:function(){},onChange:function(){editor.save().then((t=>{}))},i18n:{messages:{ui:{blockTunes:{toggler:{"Click to tune":"Tùy chọn"}},toolbar:{toolbox:{Add:"Thêm nội dung"}}}}}})}function openLibrary(t,e){const a=document.createElement("div");a.classList.add("image-library-modal"),a.innerHTML='\n      <div class="modal-content">\n        <div class="modal-header">\n          <h3>Chọn ảnh từ thư viện</h3>\n          <input type="text" class="image-search" placeholder="Tìm kiếm ảnh theo #Hashtag">\n          <button class="modal-close">×</button>\n        </div>\n        <div class="image-list"></div>\n      </div>\n    ',document.body.appendChild(a),a.querySelector(".modal-close").addEventListener("click",(()=>{a.remove()}));const n=a.querySelector(".image-search");n.addEventListener("input",(()=>{searchLibrary(a,n,t,e)})),searchLibrary(a,n,t,e)}function searchLibrary(t,e,a,n){const i=e.value.toLowerCase();t.querySelector(".image-list").innerHTML="",fetch("/Vendor/DffVn/News/Handler/File.ashx?t=5&k="+i).then((t=>t.json())).then((e=>{const i=t.querySelector(".image-list");e.data.forEach((e=>{const o=document.createElement("div");o.classList.add("image-item");const s=document.createElement("img");s.src=e.url,s.alt=e.title||"Library image",s.classList.add("image-preview");const r=document.createElement("div");r.classList.add("image-title"),r.innerHTML="#"+e.hashtag+"</br>"+(e.title||"Ảnh"),r.setAttribute("title",e.title);const l=document.createElement("button");l.innerText="Chọn",l.classList.add("image-select-button"),l.setAttribute("title",e.title);var c=0;1==n&&(c=a.api.blocks.getCurrentBlockIndex()),l.addEventListener("click",(()=>{if(1==n){const t={success:1,file:{url:e.url}};a._updateImage(c,t)}else 2==n?($(".avatarNews").attr("src",e.url),$("#Avatar").val(e.url)):3==n||4==n?a.onSelect(e.url):5==n&&$(a).parent().find("img").attr("src",e.url);t.remove()})),o.appendChild(s),o.appendChild(r),o.appendChild(l),i.appendChild(o)}))})).catch((t=>{console.log("Error fetching library images:"+t)}))}function stepEditor(t){$("#bt_estep"+t).tab("show")}function bindEditor(){cEditor={title:"",body:"",fillData:function(t,e){editor.save().then((a=>{this.body=a.blocks,this.title=$("#Title").val(),this.valid(t)&&this.saveData(e)}))},saveData:function(t){var e=Page.urlBase+"article.ashx?t="+t,a=2==t?"Bài viết của bạn đang chờ quản trị viên phê duyệt":"Bạn đã cập nhật thành công ",n=$("form").serializeArray();n.push({name:"Title",value:this.title}),n.push({name:"Body",value:JSON.stringify(this.body)});var i=$("#mnAvatar")[0].files[0],o=new FileReader;null!=i&&(o.readAsDataURL(i),o.onloadend=function(){n.push({name:"fileAsBase64",value:o.result}),n.push({name:"fileName",value:i.name}),$.ajax({type:"POST",url:e,data:n,success:function(t){Page.Notify2(a),saved=!1,200==t.code&&isRealValue(popup)&&popup.hide()},error:function(t){saved=!1}})})},valid:function(t){if(this.title.length<10)return Page.Notify2("Chủ đề không thể dưới 10 ký tự!"),stepEditor(1),!1;if(0==this.body.length)return Page.Notify2("Chưa có nội dung chủ đề!"),stepEditor(1),!1;var e;if(1==t){if(e=$(".mnImg img").attr("src"),!isRealValue(e))return stepEditor(1),void Page.Notify2("Bạn chưa chọn ảnh đại diện!")}else if(-1!==(e=$(".avatarNews").attr("src")).indexOf("img_small.jpg"))return $("#errorAvatar").show(),void scrollToError("#errorAvatar");var a=$(".cat-id").val();return 0==a?(scrollToError("#errorCat"),$("#errorCat").show(),!1):($("#CatId").val(a),!0)}};const t=document.getElementsByClassName("btnEditSave");for(var e=0;e<t.length;e++)t[e].addEventListener("click",(t=>{var e=t.target.getAttribute("ref");cEditor.fillData(e)}))}function EditorToSave(t){var e="";$("#btnSave,#btnSendEdited").off("click"),$("#nbody").is(":visible")?(e=tinymce.get("txtBody").getContent(),$("#Body").val(e),eSwitch(t)):editor.save().then((a=>{e=JSON.stringify(a.blocks),$("#Body").val(e),eSwitch(t)}))}function loadurl(){var t={url:$("#txtUrl").val()},e=Page.urlBase+"article.ashx?t=12";$.ajax({type:"POST",url:e,data:t,success:function(t){200==t.code?($("#Title").val(t.data.Title),$(".avatarNews").attr("src",t.data.Avatar),$("#Avatar").val(t.data.Avatar),$("#Body").val("<p>"+t.data.Sapo+"</p>"+t.data.Body),isRealValue(t.data.MetaDescription)?Page.Notify2(t.data.MetaDescription):Page.Notify2("Tải thành công"),$("#bodyjs").hide(),$("#nbody").show(),tinymce.get("txtBody").setContent("<p>"+t.data.Sapo+"</p>"+t.data.Body)):Page.Notify2("Website chưa được cấu hình, liên hệ với quản trị viên.")},error:function(t){}})}this.eSwitch=function(t,e){e=$("form").serializeArray();var a=$("#uploadAvatar")[0].files[0],n=new FileReader;null!=a?(n.readAsDataURL(a),n.onloadend=function(){e.push({name:"fileAsBase64",value:n.result}),e.push({name:"fileName",value:a.name}),eSaveAjax(t,e)}):eSaveAjax(t,e)},this.eSaveAjax=function(t,e){var a=Page.urlBase+"article.ashx?t="+t,n=2==t?"Bài viết của bạn đang chờ quản trị viên phê duyệt":"Bạn đã cập nhật thành công ";$.ajax({type:"POST",url:a,data:e,success:function(e){saved=!1,200==e.code?(Page.Notify2(n),sleep(1e3).then((()=>{window.location=2==t?"/article.html?s="+t:"/write.html?p="+e.data}))):(Page.Notify2(e.notify),$("#btnSave").on("click",(function(){EditorSave(1)})),$("#btnSendEdited").on("click",(function(){EditorSave(2)})))},error:function(t){saved=!1}})};var allowEditor=!0;function getBlocksAI(t){var e=t+"_article_body",a=localStorage.getItem(e);if(isNull(a))return null;var n=[],i=a.split("<br><br>").filter((t=>""!==t.trim()));return $.each(i,(function(t,e){n.push({type:"paragraph",data:{text:e}})})),localStorage.setItem(e,null),n}function generate(t){if(!isNull(t)){var e=$("#generate"),a=$("#response ul");$("#response .title").remove(),a.prepend('<li class="reply"><p><img class="waiting" src="https://media.dff.vn/static/img/dots.gif" /></p></li>'),a.prepend('<li class="send"><p>'+t+"</p></li>");var n="";$(".ai-option").each((function(){n+=$(this).data("type")+":"+$(this).find(".active").data("val")+";"}));var i=$('input[name="gpttype"]').filter(":checked").val(),o=$(".cbo-size").val(),s=$("#original-select").val();dataPost={question:t,options:n,typeGen:i,amount:1,size:o,ai:s,t:20},$.ajax({type:"POST",url:"/vendor/dffvn/news/Handler/article.ashx",data:dataPost,beforeSend:function(){e.find("img").show(),e.attr("disabled","disabled")},success:function(t){if(200==t.code){var n="";if(2==i&&null!=t.data){t.data.forEach((t=>{n+='<span class="{0}"><img class="img-gpt" src="{1}" /></span>'.format(t.Css,t.Url)}))}else n=t.data;a.find("li").eq(0).after('<li class="reply"><p>'+n+'</p><div> <span title="Copy" class="copy"><i class="fa fa-clone" aria-hidden="true"></i></span><span title="Tạo chủ đề" class="add"><i class="fa fa-plus" aria-hidden="true"></i></span></div></li>'),$(".copy i").click((function(){$(this).toggleClass("fa-clone fa-check");var t=$(this).parent().parent().parent(),e="";e=t.find("img").length?t.find("img").attr("src"):t.find("p").text(),navigator.clipboard.writeText(e)})),$(".add i").click((function(){var t=$(this).parent().parent().parent().find("p").html();localStorage.setItem(code+"_article_body",t),window.open("/write.html","_blank")}))}a.find(".waiting").parent().parent().remove(),e.find("img").hide(),e.removeAttr("disabled")}})}}function bindArticles(){$(".news_title .f-tinbai .item").each((function(){Page.loadwrite(this)}))}function bindSpAi(){$("#generate").click((function(){generate($("#txtQuestion").val())})),$('input[name="gpttype"]').on("change",(function(){1==$(this).filter(":checked").val()?$(".box-images").hide():$(".box-images").show()})),$(".autoresizing").on("input",(function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"})),ai_bindoption(),$(".ai-option a").each((function(){$(this).click((function(){var t=this,e=new Popup(300);e.title="Thêm "+$(this).attr("title"),e.content='<input type="text" id="txtAdd" class="form-control" />',e.buttons.push({value:"Thêm",icon:"fas fa-sign-out-alt",cls:"btn btn-primary",func:function(){var a=$("#txtAdd").val();Utility.isRealValue(a)&&(a=a.replace(";","").replace(":",""),$(t).before('<span data-val="'+a+'">'+a+"</span>"),ai_bindoption(),e.hide())}}),e.show()}))}));var t=$(".custom-option").first();t.addClass("selected"),updateTrigger(t),$(".custom-select-trigger").on("click",(function(){$(".custom-options").toggle()})),$(".custom-option").on("click",(function(){$(".custom-option").removeClass("selected"),$(this).addClass("selected"),updateTrigger($(this)),$(".custom-options").hide();$('input[name="gpttype"]').filter(":checked").val();var t=$(this).data("value");$("#original-select").val(t).trigger("change")})),$(window).on("click",(function(t){$(t.target).closest(".custom-select").length||$(".custom-options").hide()}))}function updateTrigger(t){var e=t.text().trim(),a=t.data("image");$(".custom-select-trigger").html('<img src="'+a+'" alt="'+e+'"> '+e)}function updateTrigger2(t){var e=t.data("value"),a=t.text().trim(),n=t.data("image");$(".custom-select-trigger").html('<span><img src="'+n+'" alt="'+a+'"> '+a+'</span><span data-ref="'+e+'" class="c-value"></span>')}function coininfo(){var t=Page.urlBase+"LoadBox.ashx?t=3",e={sym:$("#hdd_sys").val()};$.ajax({type:"POST",url:t,data:e,success:function(t){if(200==t.code){$("#hdd_id").val(t.data.objecid),Page.loadCm(0,$(".list_comment"),0,t.data.objecid,2),$(".name-coin img").attr("src",t.data.image),$(".name-coin name").text(t.data.name),$(".about-body").html(t.data.about);var e=$(".coin-baseinfo");e.find(".market_cap").text(formatMoney(t.data.market_cap,0,"")),e.find(".circulating_supply").text(formatMoney(t.data.circulating_supply,0,"")),e.find(".total_supply").text(formatMoney(t.data.total_supply,0,"")),e.find(".max_supply").text(formatMoney(t.data.max_supply,0,""));var a=t.data.market;isRealValue(a)||(a="BINANCE"),new TradingView.widget({width:"100%",height:600,symbol:a+":"+t.data.symbol+"USDT",interval:"15",timezone:"Asia/Ho_Chi_Minh",theme:"dark",style:"1",locale:"vi",toolbar_bg:"#181a20",backgroundColor:"#181a20",enable_publishing:!1,allow_symbol_change:!0,container_id:"tradingview_btc"})}}})}function coinconvert(){var t=Page.urlBase+"LoadBox.ashx?t=5",e=$(".custom-select-trigger").find(".c-value").data("ref"),a={sym:$("#hdd_sys").val(),cur:e};$.ajax({type:"POST",url:t,data:a,success:function(t){if(200==t.code){var e=$(".cv-number").val();$(".custom-select-trigger .c-value").text(formatMoney(t.data*e,2,""))}}})}function bindCoins(){var t=$(".custom-option").first();t.addClass("selected"),updateTrigger2(t),$(".custom-select-trigger").on("click",(function(){$(".custom-options").toggle()})),$(".custom-option").on("click",(function(){$(".custom-option").removeClass("selected"),$(this).addClass("selected"),updateTrigger2($(this)),$(".custom-options").hide();$('input[name="gpttype"]').filter(":checked").val();var t=$(this).data("value");$("#original-select").val(t).trigger("change"),coinconvert()})),$(window).on("click",(function(t){$(t.target).closest(".custom-select").length||$(".custom-options").hide()})),$(".cv-number").on("blur",(function(){coinconvert()})),coinconvert()}function ai_bindoption(){$(".ai-option span").each((function(){$(this).click((function(){$(this).parent().find("span").removeClass(),$(this).addClass("active")}))}))}function coin_search(){$(".mb-coins").on("click",(function(){$(".bs-coin").toggle()}));const t=document.getElementById("searchInput"),e=$("#coin_suggestions");let a;async function n(t){if(!t||t.length<2)return void e.hide();const a=Page.urlBase+`LoadBox.ashx?t=6&sym=${encodeURIComponent(t)}`;try{const t=await fetch(a);!function(t){if(0===t.length)return e.html("<li>Không có đồng coin nào được tìm thấy</li>"),void e.show();e.html(""),t.forEach((t=>{var a=`<li><img src="${t.image}" /><a href="/coins-${t.id}.html">${t.name} (${t.symbol.toUpperCase()})</a></li>`;e.append(a)})),e.show()}((await t.json()).data.slice(0,20))}catch(t){e.html("<li>...</li>")}}var i,o;t.addEventListener("input",(i=()=>{n(t.value)},o=300,function(...t){clearTimeout(a),a=setTimeout((()=>i.apply(this,t)),o)})),document.addEventListener("click",(a=>{t.contains(a.target)||document.getElementById("coin_suggestions").contains(a.target)||e.hide()}))}function infoImage(t,e){var a=Page.urlBase+"Action.ashx",n=$("#"+t)[0].files[0],i=new FileReader;null!=n?(i.readAsDataURL(n),i.onloadend=function(){var t={imgtype:e,t:15,fileAsBase64:i.result,fileName:n.name};$.ajax({type:"POST",url:a,data:t,success:function(t){Page.Notify(t.notify)}})}):Page.Notify("Lỗi file!")}function atAvatar(t){var e=$(t).val(),a=e.substring(e.lastIndexOf(".")+1).toLowerCase();if(t.files&&t.files[0]&&("gif"==a||"png"==a||"jpeg"==a||"jpg"==a)){var n=new FileReader;n.onload=function(t){$(".avatarNews").attr("src",t.target.result)},n.readAsDataURL(t.files[0])}}Page.loadeditor=function(t){if(allowEditor){var e={id:$(t).data("ref"),t:19};$.ajax({type:"POST",url:urlBase,data:e,success:function(e){if($(t).html(e.content),$("#uploadAvatar").on("change",(function(){atAvatar(this)})),tinyMCE("#txtBody",850,650,(function(){})),1==e.code){$("#bodyjs").show();var a=e.data;isNull(e.data)&&(a=getBlocksAI(e.notify)),initBlock(a)}else $("#nbody").show();$("#NewsType").change(),$("#btLoad").on("click",(function(){loadurl()})),$(".mn-editor-right .bg-options span").click((function(){var t=$(this).attr("class");$(".mn-editor-right > div:first").attr("class",t),$("#css").val(t)})),$("#btnSave").on("click",(function(){EditorSave(1)})),$("#btnSendEdited").on("click",(function(){EditorSave(2)})),$("#btnExit").on("click",(function(){window.location="/article.html?s=8"})),$(".el-tag i").click((function(){var t=$(this).parent().parent(),e=$(this).data("ref");editor.save().then((a=>{var n=extractText(a);if(isNull(n))Page.Notify("Yêu cầu nhập nội dung!");else{var i={question:n,type:e,t:21};t.find(".waiting").show(),$.ajax({type:"POST",url:"/vendor/dffvn/news/Handler/article.ashx",data:i,success:function(a){200==a.code&&(2==e?$("#MetaDescription").val(a.data):1==e&&($(".sg-tag").html(a.data),$(".sg-tag li").each((function(){var t=$(this).data("ref");$(this).click((function(){if(!isNull(t)){var e=$("#MetaKeyword"),a=e.val().trim();a=isRealValue(a)?a+","+t:t,e.val(a)}}))})))),t.find(".waiting").hide()}})}}))})),bindEditor()}})}},Page.boxCoinIndex=function(t){irequest||(irequest=!0,$.ajax({url:Page.urlBase+"loadbox.ashx?t=8",method:"POST",data:{},beforeSend:function(){},success:function(t){try{$.each(t.data.Data,(function(t,e){var a="bi bi-dash",n="nochange";e.change>0?(a="bi bi-caret-up-fill",n="up"):e.change<0&&(a="bi bi-caret-down-fill",n="down");var i=$(".co-"+e.code);i.find(".value").text(formatNumber(e.price)),i.find(".content i").attr("class",a),i.find(".content .per").text(parseFloat(e.changePct.toFixed(2))+"%"),i.find(".content index").text(parseFloat(e.change.toFixed(2))),i.find(".content").attr("class","irow content "+n)})),window.addEventListener("load",(()=>function(t,e){const a=document.querySelector(t),n=a.innerHTML,i=a.children[0];let o,s=0;function r(){o=setInterval((function(){i.style.marginLeft=`-${s}px`,fwid=1500,s>fwid&&(s=0),s+=e}),0)}a.insertAdjacentHTML("beforeend",n),a.addEventListener("mouseenter",(function(){clearInterval(o)})),a.addEventListener("mouseleave",r),r()}(".marquee",.2)))}catch{}irequest=!1}}))},$((function(){$(".menu").on("click",(function(){$(".menu > i").toggleClass("bi-arrow-bar-right bi-arrow-bar-left",300),$(".main").toggleClass("show-sidebar",500),$("body").toggleClass("push-body",500)})),$(".menu").click(),$(".l-article i").on("click",(function(){"fas fa-bars"==$(this).attr("class")?($(".left-sidebar").show(500),$(this).attr("class","fas fa-times")):($(".left-sidebar").hide(500),$(this).attr("class","fas fa-bars"))}))})),this.abInit=function(){var t=$("#NewsId").val();$("#imageList tr").each((function(){var e=$(this).data("id");$(this).find(".ab-upload").on("change",(function(){atAlbum(this,$(this).parent().parent().find("img"))})),$(this).find(".jsimgcancel").click((function(){openLibrary(this,5)})),$(this).find(".ab-save").click((function(){var a=$(this).parent().parent(),n=a.find("img").attr("src"),i=a.index()+1,o=a.find("textarea").val();PhotoSave(e,t,n,o,i)})),$(this).find(".ab-delete").click((function(){Page.Alert("Bạn chắc chắn muốn gỡ bài này?",(function(){var a={id:e},n=Page.urlBase+"article.ashx?t=24";$.ajax({type:"POST",async:!1,url:n,data:a,cache:!1,success:function(e){200==e.code?(alert("Bạn đã cập nhật thành công"),LoadPhotos(t)):alert("Có lỗi xảy ra!")}})}))}))}))},this.atAlbum=async function(t,e){var a=$(t).val(),n=a.substring(a.lastIndexOf(".")+1).toLowerCase();if(t.files&&t.files[0]&&("gif"==n||"png"==n||"jpeg"==n||"jpg"==n)){(new FileReader).readAsDataURL(t.files[0]);const a=new FormData;a.append("image",t.files[0]);const n=await fetch("/Vendor/DffVn/News/Handler/File.ashx?t=3",{method:"POST",body:a}),i=await n.json();if(!i.file.url)throw new Error("Không nhận được URL ảnh từ server");$(e).attr("src",i.file.url)}},this.LoadPhotos=function(t){if(!(t<=0)){var e={nid:t},a=Page.urlBase+"article.ashx?t=22";$.ajax({type:"POST",url:a,data:e,cache:!1,success:function(t){200==t.code&&($("#imageList").html(t.data),abInit())}})}},this.PhotoSave=function(t,e,a,n,i){if(a.length<1||a==image_default)alert("Bạn chưa chọn ảnh!");else{var o={Id:t,nid:e,src:a,title:n,stt:i},s=Page.urlBase+"article.ashx?t=23";$.ajax({type:"POST",async:!1,url:s,data:o,cache:!1,success:function(a){200==a.code?(0==t&&LoadPhotos(e),alert("Bạn đã cập nhật thành công!")):alert(a.Message)}})}};var image_default="/Vendor/DffVn/Content/img/img_small.jpg";class MarkerTool{static get isInline(){return!0}get state(){return this._state}set state(t){this._state=t,this.button.classList.toggle(this.api.styles.inlineToolButtonActive,t)}constructor({api:t}){this.api=t,this.button=null,this._state=!1,this.tag="MARK",this.class="cdx-marker",this.nodes={wrapper:null,container:null,input:null,inputHolder:null}}get CSS(){return{baseClass:this.api.styles.block,input:this.api.styles.input,container:"link-tool",inputEl:"link-tool__input",inputHolder:"link-tool__input-holder"}}make(t,e=null,a={}){const n=document.createElement(t);Array.isArray(e)?n.classList.add(...e):e&&n.classList.add(e);for(const t in a)n[t]=a[t];return n}render(){return this.nodes.wrapper=this.make("div",this.CSS.baseClass),this.nodes.container=this.make("div",this.CSS.container),this.nodes.wrapper.appendChild(this.nodes.container),this.button=document.createElement("button"),this.button.type="button",this.button.innerHTML='<svg width="20" height="18"><path d="M10.458 12.04l2.919 1.686-.781 1.417-.984-.03-.974 1.687H8.674l1.49-2.583-.508-.775.802-1.401zm.546-.952l3.624-6.327a1.597 1.597 0 0 1 2.182-.59 1.632 1.632 0 0 1 .615 2.201l-3.519 6.391-2.902-1.675zm-7.73 3.467h3.465a1.123 1.123 0 1 1 0 2.247H3.273a1.123 1.123 0 1 1 0-2.247z"/></svg>',this.button.classList.add(this.api.styles.inlineToolButton),this.button}surround(t){this.state?this.unwrap(t):this.wrap(t)}wrap(t){const e=t.extractContents();new Promise((a=>{var n=Page.urlBase+"article.ashx?t=17";popup=new Popup(450),popup.showCancel=!1,popup.title="Chọn chủ đề phù hợp ",popup.content='<div class="row"><div class="col-sm-8"><input class="form-control" id="txtSearch" value="'+e.textContent+'"></div><div class="col-sm-4"><button class="btn btn-primary" id="btn_searchTag">Tìm kiếm</button></div></div><div id="list_tag"></div>',popup.close=function(){t.insertNode(e),popup.hide()},popup.show(),$("#btn_searchTag").click((function(){var a={key:$("#txtSearch").val()};$.ajax({type:"POST",url:n,data:a,success:function(a){$("#list_tag").html(a.data),$(".box-asign-tag a").each((function(a){var n=$(this);n.on("click",(function(){n.attr("data-href"),e.textContent;var a=document.createElement("a");a.innerHTML=e.textContent,a.href=n.attr("data-href"),t.insertNode(a),popup.hide()}))}))}})})),$("#btn_searchTag").click()}))}unwrap(t){const e=this.api.selection.findParentTag(this.tag,this.class),a=t.extractContents();e.remove(),t.insertNode(a)}checkState(){const t=this.api.selection.findParentTag(this.tag);this.state=!!t}}